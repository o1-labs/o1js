"use strict";(self.webpackChunkdocumentation_site=self.webpackChunkdocumentation_site||[]).push([[5804],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var s=t(96540);const r={},a=s.createContext(r);function o(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(a.Provider,{value:n},e.children)}},57145:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"api-reference/classes/TokenAccountUpdateIterator","title":"TokenAccountUpdateIterator","description":"Defined in54","source":"@site/versioned_docs/version-2.4.0/api-reference/classes/TokenAccountUpdateIterator.mdx","sourceDirName":"api-reference/classes","slug":"/api-reference/classes/TokenAccountUpdateIterator","permalink":"/o1js/2.4.0/api-reference/classes/TokenAccountUpdateIterator","draft":false,"unlisted":false,"editUrl":"https://github.com/versioned_docs/version-2.4.0/api-reference/classes/TokenAccountUpdateIterator.mdx","tags":[],"version":"2.4.0","frontMatter":{},"sidebar":"docs","previous":{"title":"SmartContract","permalink":"/o1js/2.4.0/api-reference/classes/SmartContract"},"next":{"title":"TokenContract","permalink":"/o1js/2.4.0/api-reference/classes/TokenContract"}}');var r=t(74848),a=t(28453);const o={},i=void 0,c={},d=[{value:"Constructors",id:"constructors",level:2},{value:"new TokenAccountUpdateIterator()",id:"new-tokenaccountupdateiterator",level:3},{value:"Parameters",id:"parameters",level:4},{value:"forest",id:"forest",level:5},{value:"mayUseToken",id:"mayusetoken",level:5},{value:"selfToken",id:"selftoken",level:5},{value:"Returns",id:"returns",level:4},{value:"Properties",id:"properties",level:2},{value:"currentLayer",id:"currentlayer",level:3},{value:"selfToken",id:"selftoken-1",level:3},{value:"unfinishedParentLayers",id:"unfinishedparentlayers",level:3},{value:"Methods",id:"methods",level:2},{value:"assertFinished()",id:"assertfinished",level:3},{value:"Parameters",id:"parameters-1",level:4},{value:"message?",id:"message",level:5},{value:"Returns",id:"returns-1",level:4},{value:"next()",id:"next",level:3},{value:"Returns",id:"returns-2",level:4},{value:"accountUpdate",id:"accountupdate",level:5},{value:"usesThisToken",id:"usesthistoken",level:5},{value:"create()",id:"create",level:3},{value:"Parameters",id:"parameters-2",level:4},{value:"forest",id:"forest-1",level:5},{value:"selfToken",id:"selftoken-2",level:5},{value:"Returns",id:"returns-3",level:4}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Defined in: ",(0,r.jsx)(n.a,{href:"https://github.com/o1-labs/o1js/blob/df1ff77af12d7cbbed4a6167f02815fad4f0dceb/src/lib/mina/v1/token/forest-iterator.ts#L54",children:"lib/mina/v1/token/forest-iterator.ts:54"})]}),"\n",(0,r.jsx)(n.p,{children:"Data structure to represent a forest of account updates that is being iterated over,\nin the context of a token manager contract."}),"\n",(0,r.jsx)(n.p,{children:"The iteration is done in a depth-first manner."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"let forest: AccountUpdateForest = ...;\nlet tokenIterator = TokenAccountUpdateIterator.create(forest, tokenId);\n\n// process the first 5 account updates in the tree\nfor (let i = 0; i < 5; i++) {\n let { accountUpdate, usesThisToken } = tokenIterator.next();\n // ... do something with the account update ...\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important"}),": Since this is specifically used by token manager contracts to process their entire subtree\nof account updates, the iterator skips subtrees that don't inherit token permissions and can therefore definitely not use the token."]}),"\n",(0,r.jsxs)(n.p,{children:["So, the assumption is that the consumer of this iterator is only interested in account updates that use the token.\nWe still can't avoid processing some account updates that don't use the token, therefore the iterator returns a boolean\n",(0,r.jsx)(n.code,{children:"usesThisToken"})," alongside each account update."]}),"\n",(0,r.jsx)(n.h2,{id:"constructors",children:"Constructors"}),"\n",(0,r.jsx)(n.h3,{id:"new-tokenaccountupdateiterator",children:"new TokenAccountUpdateIterator()"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"new TokenAccountUpdateIterator(\n   forest: MerkleListIterator<AccountUpdateTreeBase>, \n   mayUseToken: MayUseToken, \n   selfToken: Field): TokenAccountUpdateIterator\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Defined in: ",(0,r.jsx)(n.a,{href:"https://github.com/o1-labs/o1js/blob/df1ff77af12d7cbbed4a6167f02815fad4f0dceb/src/lib/mina/v1/token/forest-iterator.ts#L59",children:"lib/mina/v1/token/forest-iterator.ts:59"})]}),"\n",(0,r.jsx)(n.h4,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsx)(n.h5,{id:"forest",children:"forest"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"/o1js/2.4.0/api-reference/classes/MerkleListIterator",children:(0,r.jsx)(n.code,{children:"MerkleListIterator"})}),"<",(0,r.jsx)(n.code,{children:"AccountUpdateTreeBase"}),">"]}),"\n",(0,r.jsx)(n.h5,{id:"mayusetoken",children:"mayUseToken"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"MayUseToken"})}),"\n",(0,r.jsx)(n.h5,{id:"selftoken",children:"selfToken"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"/o1js/2.4.0/api-reference/classes/Field",children:(0,r.jsx)(n.code,{children:"Field"})})}),"\n",(0,r.jsx)(n.h4,{id:"returns",children:"Returns"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"/o1js/2.4.0/api-reference/classes/TokenAccountUpdateIterator",children:(0,r.jsx)(n.code,{children:"TokenAccountUpdateIterator"})})}),"\n",(0,r.jsx)(n.h2,{id:"properties",children:"Properties"}),"\n",(0,r.jsx)(n.h3,{id:"currentlayer",children:"currentLayer"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"currentLayer: Layer;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Defined in: ",(0,r.jsx)(n.a,{href:"https://github.com/o1-labs/o1js/blob/df1ff77af12d7cbbed4a6167f02815fad4f0dceb/src/lib/mina/v1/token/forest-iterator.ts#L55",children:"lib/mina/v1/token/forest-iterator.ts:55"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"selftoken-1",children:"selfToken"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"selfToken: Field;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Defined in: ",(0,r.jsx)(n.a,{href:"https://github.com/o1-labs/o1js/blob/df1ff77af12d7cbbed4a6167f02815fad4f0dceb/src/lib/mina/v1/token/forest-iterator.ts#L57",children:"lib/mina/v1/token/forest-iterator.ts:57"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"unfinishedparentlayers",children:"unfinishedParentLayers"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"unfinishedParentLayers: MerkleList<Layer>;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Defined in: ",(0,r.jsx)(n.a,{href:"https://github.com/o1-labs/o1js/blob/df1ff77af12d7cbbed4a6167f02815fad4f0dceb/src/lib/mina/v1/token/forest-iterator.ts#L56",children:"lib/mina/v1/token/forest-iterator.ts:56"})]}),"\n",(0,r.jsx)(n.h2,{id:"methods",children:"Methods"}),"\n",(0,r.jsx)(n.h3,{id:"assertfinished",children:"assertFinished()"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"assertFinished(message?: string): void\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Defined in: ",(0,r.jsx)(n.a,{href:"https://github.com/o1-labs/o1js/blob/df1ff77af12d7cbbed4a6167f02815fad4f0dceb/src/lib/mina/v1/token/forest-iterator.ts#L129",children:"lib/mina/v1/token/forest-iterator.ts:129"})]}),"\n",(0,r.jsx)(n.h4,{id:"parameters-1",children:"Parameters"}),"\n",(0,r.jsx)(n.h5,{id:"message",children:"message?"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"string"})}),"\n",(0,r.jsx)(n.h4,{id:"returns-1",children:"Returns"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"void"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"next",children:"next()"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"next(): {\n  accountUpdate: AccountUpdate;\n  usesThisToken: Bool;\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Defined in: ",(0,r.jsx)(n.a,{href:"https://github.com/o1-labs/o1js/blob/df1ff77af12d7cbbed4a6167f02815fad4f0dceb/src/lib/mina/v1/token/forest-iterator.ts#L88",children:"lib/mina/v1/token/forest-iterator.ts:88"})]}),"\n",(0,r.jsx)(n.p,{children:"Make a single step along a tree of account updates."}),"\n",(0,r.jsx)(n.p,{children:"This function is guaranteed to visit each account update in the tree that uses the token\nexactly once, when called repeatedly."}),"\n",(0,r.jsxs)(n.p,{children:["The method makes a best effort to avoid visiting account updates that are not using the token,\nand in particular, to avoid returning dummy updates.\nHowever, neither can be ruled out. We're returning ",(0,r.jsx)(n.code,{children:"{ update, usesThisToken: Bool }"})," and let the\ncaller handle the irrelevant case where ",(0,r.jsx)(n.code,{children:"usesThisToken"})," is false."]}),"\n",(0,r.jsx)(n.h4,{id:"returns-2",children:"Returns"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"{\n  accountUpdate: AccountUpdate;\n  usesThisToken: Bool;\n}\n"})}),"\n",(0,r.jsx)(n.h5,{id:"accountupdate",children:"accountUpdate"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"accountUpdate: AccountUpdate = update;\n"})}),"\n",(0,r.jsx)(n.h5,{id:"usesthistoken",children:"usesThisToken"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"usesThisToken: Bool;\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"create",children:"create()"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"static create(forest: AccountUpdateForest, selfToken: Field): TokenAccountUpdateIterator\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Defined in: ",(0,r.jsx)(n.a,{href:"https://github.com/o1-labs/o1js/blob/df1ff77af12d7cbbed4a6167f02815fad4f0dceb/src/lib/mina/v1/token/forest-iterator.ts#L69",children:"lib/mina/v1/token/forest-iterator.ts:69"})]}),"\n",(0,r.jsx)(n.h4,{id:"parameters-2",children:"Parameters"}),"\n",(0,r.jsx)(n.h5,{id:"forest-1",children:"forest"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"/o1js/2.4.0/api-reference/classes/AccountUpdateForest",children:(0,r.jsx)(n.code,{children:"AccountUpdateForest"})})}),"\n",(0,r.jsx)(n.h5,{id:"selftoken-2",children:"selfToken"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"/o1js/2.4.0/api-reference/classes/Field",children:(0,r.jsx)(n.code,{children:"Field"})})}),"\n",(0,r.jsx)(n.h4,{id:"returns-3",children:"Returns"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"/o1js/2.4.0/api-reference/classes/TokenAccountUpdateIterator",children:(0,r.jsx)(n.code,{children:"TokenAccountUpdateIterator"})})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);